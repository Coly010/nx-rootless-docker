launch-templates:
  linux-medium:
    resource-class: 'docker_linux_amd64/medium+'
    image: 'ubuntu22.04-node20.9-withDind-v11'
    env:
      GIT_AUTHOR_EMAIL: test@test.com
      GIT_AUTHOR_NAME: Test
      GIT_COMMITTER_EMAIL: test@test.com
      GIT_COMMITTER_NAME: Test
      SELECTED_PM: 'pnpm'

      NX_NATIVE_LOGGING: 'nx::native::db'
    init-steps:
      - name: Checkout
        uses: 'nrwl/nx-cloud-workflows/v5/workflow-steps/checkout/main.yaml'

      - name: Check Node Version
        script: node --version

#      - name: RootlessKit Setup
#        script: echo 0 | sudo tee /proc/sys/kernel/apparmor_restrict_unprivileged_userns

      - name: Install uidmap
        script: sudo apt-get install -y uidmap

      - name: Setup Docker Rootless
        script: |
          curl -o install.sh -fsSL https://get.docker.com
          sudo sh install.sh
          dockerd-rootless-setuptool.sh install
          docker context use rootless

      - name: Set Docker Env Vars - Path
        script: export PATH=/home/testuser/bin:$PATH

      - name: Set Docker Env Vars - Docker Host
        script: export DOCKER_HOST=unix:///run/user/1000/docker.sock
